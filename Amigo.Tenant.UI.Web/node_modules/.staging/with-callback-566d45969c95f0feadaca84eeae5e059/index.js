"use strict";


function withCallback(args, closure, value_mapper) {
  return new Promise(function(resolve, reject) {
    if (Array.isArray(args)) {
      args = args.slice();
    }
    else {
      value_mapper = closure;
      closure = args;
      args = null;
    }

    function cb(err, value) {
      if (err) {
        reject(err);
        return;
      }

      if (!value_mapper) {
        resolve(value);
        return;
      }

      try {
        resolve(value_mapper.apply(undefined, Array.prototyp